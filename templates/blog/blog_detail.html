{% extends "base.html" %}
{% load static %}

{% block meta_data %}
    <meta name="description" content="{{ meta_details }}">
    <meta property="og:title" content="{{ title }}">
    <meta property="og:description" content="{{ meta_details }}">
    {% if post.featured_image %}
        <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ post.featured_image.url }}">
        <meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{{ post.featured_image.url }}">
    {% endif %}
    <link rel="canonical" href="{{ request.build_absolute_uri }}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="{{ post.created_at|date:'c' }}">
    <meta property="article:author" content="{{ post.author.get_full_name|default:post.author.username }}">
{% endblock meta_data %}

{% block title %}<title>{{ title }} - Digital Codex</title>{% endblock title %}

{% block content %}
    <div class="reading-progress"><div class="progress-bar" id="readingProgress"></div></div>

    <nav class="detail-nav">
        <div class="nav-container">
            <a href="{% url 'blog:list' %}" class="nav-back"><i class="fas fa-arrow-left"></i><span>Back to Blog</span></a>
            <div class="nav-actions">
                <button class="share-btn" id="shareBtn"><i class="fas fa-share-alt"></i><span>Share</span></button>
                <button class="bookmark-btn" id="bookmarkBtn"><i class="fas fa-bookmark"></i><span>Save</span></button>
            </div>
        </div>
    </nav>

    <div class="article-container">
        <header class="article-header">
            <span class="article-category">{{ post.categories.first.name|default:'General' }}</span>
            <h1 class="article-title">{{ post.title }}</h1>
            <div class="article-meta">
                <div class="meta-item"><i class="fas fa-user"></i><span>{{ post.author.get_full_name|default:post.author.username }}</span></div>
                <div class="meta-item"><i class="fas fa-calendar"></i><span>{{ post.created_at|date:"F d, Y" }}</span></div>
                <div class="meta-item"><i class="fas fa-clock"></i><span>{{ post.read_time }} min read</span></div>
                <div class="meta-item"><i class="fas fa-eye"></i><span>{{ post.view_count }} views</span></div>
            </div>
        </header>

        {% if post.featured_image %}
            <div class="article-image"><img src="{{ post.featured_image.url }}" alt="{{ post.title }}" style="width:100%; height:auto; border-radius:15px; margin-bottom: 2rem;"></div>
        {% endif %}
        
        <article class="article-content">
            {{ post.content|safe }}
        </article>

        <!-- <div class="article-tags">
            {% for category in post.categories.all %}
                 <a href="{% url 'blog:list_by_category' category.slug %}" class="article-tag">{{ category.name }}</a>
            {% endfor %}
        </div> -->

        <div class="author-section">
            <div class="author-avatar">
                 {% if post.author.first_name %}{{ post.author.first_name|first }}{{ post.author.last_name|first }}{% else %}{{ post.author.username|first|upper }}{% endif %}
            </div>
            <div class="author-info">
                <h3>{{ post.author.get_full_name|default:post.author.username }}</h3>
                <p class="author-bio">Full Stack Software Developer with 9+ years of experience in Python, PHP, and ReactJS. Passionate about AI, machine learning, and the intersection of technology and human creativity.</p>
            </div>
        </div>

        <section class="related-posts">
            <h2 class="related-title">Related Articles : {% for category in post.categories.all %} <a href="{% url 'blog:list_by_category' category.slug %}" class="article-tag">{{ category.name }}</a>{% endfor %}</h2>
            <div class="related-grid">
                {% for related_post in related_posts %}
                    <div class="related-card" onclick="window.location.href='{% url 'blog:detail' related_post.slug %}'">
                        <h4>{{ related_post.title }}</h4>
                        <p>{{ related_post.excerpt|striptags|truncatechars:100 }}</p>
                    </div>
                {% empty %}
                    <p>No related articles found.</p>
                {% endfor %}
            </div>
        </section>
    </div>
{% endblock %}
