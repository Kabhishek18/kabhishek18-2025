{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:blog_linkedinconfig_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; {{ title }}
</div>
{% endblock %}

{% block content %}
<div class="module aligned">
    <h1>{{ title }}</h1>
    
    <div class="form-row">
        <div class="help">
            <p><strong>Security Notice:</strong> These credentials will be encrypted before storage. 
            Only enter credentials here if you trust this admin interface.</p>
            
            <p><strong>LinkedIn API Setup:</strong></p>
            <ul>
                <li>Create a LinkedIn app at <a href="https://www.linkedin.com/developers/" target="_blank">LinkedIn Developers</a></li>
                <li>Get your Client ID and Client Secret from the app settings</li>
                <li>Complete OAuth flow to get access and refresh tokens</li>
                <li>Token expiration is typically 60 days for LinkedIn</li>
            </ul>
        </div>
    </div>
    
    <form method="post" novalidate>
        {% csrf_token %}
        
        <fieldset class="module aligned">
            <h2>Current Status</h2>
            <div class="form-row">
                <div>
                    <label>Client ID:</label>
                    <p>{{ config.client_id|default:"Not set" }}</p>
                </div>
            </div>
            
            <div class="form-row">
                <div>
                    <label>Client Secret:</label>
                    <p>{% if config.client_secret %}Set (encrypted){% else %}Not set{% endif %}</p>
                </div>
            </div>
            
            <div class="form-row">
                <div>
                    <label>Access Token:</label>
                    <p>{% if config.access_token %}Set (encrypted){% else %}Not set{% endif %}</p>
                </div>
            </div>
            
            <div class="form-row">
                <div>
                    <label>Token Expires:</label>
                    <p>{{ config.token_expires_at|default:"Not set" }}</p>
                </div>
            </div>
        </fieldset>
        
        <fieldset class="module aligned">
            <h2>Update Credentials</h2>
            <p class="help">Leave fields blank to keep current values.</p>
            
            <div class="form-row">
                <div>
                    <label for="id_client_secret">Client Secret:</label>
                    <input type="password" name="client_secret" id="id_client_secret" class="vTextField" autocomplete="new-password">
                    <p class="help">Your LinkedIn app's client secret</p>
                </div>
            </div>
            
            <div class="form-row">
                <div>
                    <label for="id_access_token">Access Token:</label>
                    <textarea name="access_token" id="id_access_token" class="vLargeTextField" rows="3" autocomplete="new-password"></textarea>
                    <p class="help">OAuth access token from LinkedIn</p>
                </div>
            </div>
            
            <div class="form-row">
                <div>
                    <label for="id_refresh_token">Refresh Token:</label>
                    <textarea name="refresh_token" id="id_refresh_token" class="vLargeTextField" rows="3" autocomplete="new-password"></textarea>
                    <p class="help">OAuth refresh token from LinkedIn (optional)</p>
                </div>
            </div>
            
            <div class="form-row">
                <div>
                    <label for="id_expires_in">Token Expires In (seconds):</label>
                    <input type="number" name="expires_in" id="id_expires_in" class="vIntegerField" placeholder="5184000">
                    <p class="help">Token lifetime in seconds (e.g., 5184000 for 60 days)</p>
                </div>
            </div>
        </fieldset>
        
        <div class="submit-row">
            <input type="submit" value="Update Credentials" class="default" name="_save">
            <a href="{% url 'admin:blog_linkedinconfig_changelist' %}" class="button cancel-link">Cancel</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add confirmation for credential updates
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        const hasCredentials = document.getElementById('id_client_secret').value || 
                              document.getElementById('id_access_token').value || 
                              document.getElementById('id_refresh_token').value;
        
        if (hasCredentials) {
            if (!confirm('Are you sure you want to update these credentials? This will overwrite existing values.')) {
                e.preventDefault();
            }
        }
    });
});
</script>
{% endblock %}